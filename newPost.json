{"title":"使用脚本自动抢Oracle ARM服务器，并使用tg机器人通知","id":"2021/11/28/oraclearm/","date_published":"11/28/2021","summary":"\n转载自HM的博客 https://him.plus/archives/274\n\n\n        需要用到的\n\n一台vps服务器\nTerraform\noci-cli\n一、安装Terraform\n\n\nwget https:&#x2F;&#x2F;releases.hashicorp.com&#x2F;terraform&#x2F;0.15.5&#x2F;terraform_0.15.5_linux_amd64.zip\n解压，并移动文件terraform到/usr/bin目录\n\nunzip terraform_0.15.5_linux_amd64.zipmv terraform &#x2F;usr&#x2F;bin\n使用以下命令查看版本\nterraform version\n显示如下则安装成功\n\n二、安装oci-cli工具\n使用以下命令安装oci-cli工具\nbash -c &quot;$(curl –L https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;oracle&#x2F;oci-cli&#x2F;master&#x2F;scripts&#x2F;install&#x2F;install.sh)&quot;\n一直回车即可\n当出现:\n\n这个时候，是在提示你输入y回车，会自动添加环境变量\n之后又是一直回车。出现如下提示表示安装成功。可以用：oci -v  查询版本\n\n三、复制用户和租户的ocid\n甲骨文后台右上角—用户设置—点击用户以及租户，在信息栏中有我们需要的ID，分别点击复制，可以保存在记事本备份好\n\n\n四、配置cli\n输入如下代码开始配置，配置的路径默认在root目录\noci setup config\n具体配置看下面\n\nEnter a location for your config [&#x2F;root&#x2F;.oci&#x2F;config]: Enter a user OCID: #输入你的用户OCIDEnter a tenancy OCID: #输入你的租户OCIDEnter a region by index or name(e.g.1: ap-chiyoda-1, 2: ap-chuncheon-1, 3: ap-hyderabad-1, 4: ap-melbourne-1, 5: ap-mumbai-1,6: ap-osaka-1, 7: ap-seoul-1, 8: ap-sydney-1, 9: ap-tokyo-1, 10: ca-montreal-1,11: ca-toronto-1, 12: eu-amsterdam-1, 13: eu-frankfurt-1, 14: eu-zurich-1, 15: me-dubai-1,16: me-jeddah-1, 17: sa-santiago-1, 18: sa-saopaulo-1, 19: uk-cardiff-1, 20: uk-gov-cardiff-1,21: uk-gov-london-1, 22: uk-london-1, 23: us-ashburn-1, 24: us-gov-ashburn-1, 25: us-gov-chicago-1,26: us-gov-phoenix-1, 27: us-langley-1, 28: us-luke-1, 29: us-phoenix-1, 30: us-sanjose-1): 9  #这里选择你的区域Do you want to generate a new API Signing RSA key pair? (If you decline you will be asked to supply the path to an existing key.) [Y&#x2F;n]: y  #输入y生成公钥Enter a directory for your keys to be created [&#x2F;root&#x2F;.oci]: Enter a name for your key [oci_api_key]: Public key written to: &#x2F;root&#x2F;.oci&#x2F;oci_api_key_public.pemEnter a passphrase for your private key (empty for no passphrase): Private key written to: &#x2F;root&#x2F;.oci&#x2F;oci_api_key.pemFingerprint: Config written to &#x2F;root&#x2F;.oci&#x2F;config     If you haven&#39;t already uploaded your API Signing public key through the    console, follow the instructions on the page linked below in the section    &#39;How to upload the public key&#39;:    https:&#x2F;&#x2F;docs.cloud.oracle.com&#x2F;Content&#x2F;API&#x2F;Concepts&#x2F;apisigningkey.htm#How2\n\n复制生成的公钥，使用以下命令获取公钥\n\ncat &#x2F;root&#x2F;.oci&#x2F;oci_api_key_public.pem\n\n把显示出来的内容复制,并且添加到\n甲骨文后台—用户设置—资源—API秘钥—添加API秘钥\n\n\noci iam availability-domain list\n\n提示以下内容则是配置正确\n\n\n\n五、Terraform环境初始化\n1、我们先获取甲骨文的Terraform脚本\n点击 创建VM实例\n\n\n\n\n\n一直下一步\n\n\n\n2、配置Terraform\n使用以下命令创建Terraform运行目录\n\ncd &#x2F;opt&#x2F;mkdir terraform-learning &amp;&amp; cd terraform-learning\n\n\n将刚刚解压到桌面的main.tf文件 上传到这个目录\n\n\n\n\n将目录设置为Terraform运行目录\nterraform init\n以上完成后，开始创建任务，用命令：（注意还是在/opt/terraform-learning）\n\nterraform apply\n执行完上面命令之后，会提示输入yes\n\n\n\n\n上图还能看到API返回Error Message: Out of host capacity,提示主机容量不足，下面就用脚本来不停刷就行了\n六、部署脚本\n终于可以部署脚本来抢服务器了，请先获取telegram账号id，并且关注通知机器人@oracle_message_bot\nTG id请通过@userinfobot机器人获取\n在root目录下新建一个terraform.sh\n\ncd &#x2F;rootvi terraform.sh\n写入以下内容\n\n#!&#x2F;bin&#x2F;bash path&#x3D;&#39;&#x2F;opt&#x2F;terraform-learning&#x2F;&#39;FIND_FILE&#x3D;&quot;&#x2F;root&#x2F;terraform.log&quot; #日志文件位置FIND_STR&#x3D;&quot;Apply complete!&quot;cd $path &amp;&amp;while truedo    echo &#39;yes&#39; | terraform apply -lock&#x3D;false    sleep 1sdoneif [ grep -c &quot;$FIND_STR&quot; $FIND_FILE -ne &#39;20&#39; ];then    curl --location --request POST &#39;https:&#x2F;&#x2F;api.telegram.org&#x2F;bot2124631392:AAHtVpEm7KRWo6ulYNG_Zbz98irpmTSIf8o&#x2F;sendMessage&#39; \\--form &#39;text&#x3D;服务器创建成功！&#39; \\--form &#39;chat_id&#x3D;你的tg id&#39; \\--form &#39;parse_mode&#x3D;markdown&#39;pkill terraform    exit 0fi\n\n给Shell脚本赋予执行权限：\n\nchmod +x terraform.sh\n\n使用以下命令后台执行脚本\n\nnohup .&#x2F;terraform.sh &gt;&gt; terraform.log 2&gt;&amp;1  &amp;\n如何结束脚本？\n使用以下命令结束脚本\n\npkill terraform\n\n\n转载自HM的博客 https://him.plus/archives/274\n\n","url":"https://ednovas.xyz/2021/11/28/oraclearm/","tags":["VPS"],"categories":["VPS"]}